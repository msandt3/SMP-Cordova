/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.m.RatingIndicator");jQuery.sap.require("sap.m.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.m.RatingIndicator",{metadata:{library:"sap.m",properties:{"visible":{type:"boolean",group:"Behavior",defaultValue:true},"enabled":{type:"boolean",group:"Behavior",defaultValue:true},"maxValue":{type:"int",group:"Behavior",defaultValue:5},"value":{type:"float",group:"Behavior",defaultValue:0,bindable:"bindable"},"iconSize":{type:"sap.ui.core.CSSSize",group:"Behavior",defaultValue:'2rem'},"iconSelected":{type:"sap.ui.core.URI",group:"Behavior",defaultValue:null},"iconUnselected":{type:"sap.ui.core.URI",group:"Behavior",defaultValue:null},"iconHovered":{type:"sap.ui.core.URI",group:"Behavior",defaultValue:null},"visualMode":{type:"sap.m.RatingIndicatorVisualMode",group:"Behavior",defaultValue:sap.m.RatingIndicatorVisualMode.Half}},aggregations:{"_iconsSelected":{type:"sap.ui.core.Control",multiple:true,singularName:"_iconsSelected",visibility:"hidden"},"_iconsUnselected":{type:"sap.ui.core.Control",multiple:true,singularName:"_iconsUnselected",visibility:"hidden"},"_iconsHovered":{type:"sap.ui.core.Control",multiple:true,singularName:"_iconsHovered",visibility:"hidden"}},associations:{"ariaDescribedBy":{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},"ariaLabelledBy":{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{"change":{},"liveChange":{}}}});sap.m.RatingIndicator.M_EVENTS={'change':'change','liveChange':'liveChange'};jQuery.sap.require("sap.ui.core.IconPool");
sap.m.RatingIndicator.prototype.init=function(){this.allowTextSelection(false);this._iIconCounter=0};
sap.m.RatingIndicator.prototype.setValue=function(v){if(v<0){return this}if(isNaN(v)){jQuery.sap.log.warning('Ignored new rating value "'+v+'" because it is NAN')}else if(jQuery.sap.byId(this.getId()).length&&(v>this.getMaxValue())){jQuery.sap.log.warning('Ignored new rating value "'+v+'" because it is out  of range (0-'+this.getMaxValue()+')')}else{v=this._roundValueToVisualMode(v);this.setProperty("value",v,true);this._updateUI(v)}return this};
sap.m.RatingIndicator.prototype.setIconSelected=function(u){var I=this.getAggregation("_iconsSelected"),i=0;if(I){for(;i<I.length;i++){I[i].setSrc(u)}}this.setProperty("iconSelected",u,true)};
sap.m.RatingIndicator.prototype.setIconUnselected=function(u){var I=this.getAggregation("_iconsUnselected"),i=0;if(I){for(;i<I.length;i++){I[i].setSrc(u)}}this.setProperty("iconUnselected",u,true)};
sap.m.RatingIndicator.prototype.setIconHovered=function(u){var I=this.getAggregation("_iconsHovered"),i=0;if(I){for(;i<I.length;i++){I[i].setSrc(u)}}this.setProperty("iconHovered",u,true)};
sap.m.RatingIndicator.prototype.onBeforeRendering=function(){var v=this.getValue();var m=this.getMaxValue();if(v>m){this.setValue(m);jQuery.sap.log.warning("Set value to maxValue because value is > maxValue ("+v+" > "+m+").")}else if(v<0){this.setValue(0);jQuery.sap.log.warning("Set value to 0 because value is < 0 ("+v+" < 0).")}};
sap.m.RatingIndicator.prototype.exit=function(){delete this._iIconCounter;delete this._fStartValue};
sap.m.RatingIndicator.prototype._updateUI=function(v,h){jQuery.sap.require("sap.ui.core.theming.Parameters");var s=jQuery.sap.byId(this.getId()+"-sel"),u=jQuery.sap.byId(this.getId()+"-unsel-wrapper"),H=jQuery.sap.byId(this.getId()+"-hov");var i=parseFloat(sap.ui.core.theming.Parameters.get("sapUiRIIconPadding"))||0,I=parseFloat(this.getIconSize())||1,a=/[a-zA-Z]+/.exec(this.getIconSize())||"rem",S=this.getMaxValue();var b=v*I+(Math.round(v)-1)*i;if(b<0){b=0}var w=S*(I+i)-i;u.width((w-b)+a);if(h){H.width(b+a);s.hide();H.show()}else{s.width(b+a);H.hide();s.show()}jQuery.sap.log.debug("Updated rating UI with value "+v+" and hover mode "+h)};
sap.m.RatingIndicator.prototype._getIcon=function(s){var i=null,u=null;switch(s){case 1:u=this.getIconUnselected()||sap.ui.core.IconPool.getIconURI("favorite");break;case 2:u=this.getIconHovered()||sap.ui.core.IconPool.getIconURI("favorite");break;case 0:u=this.getIconSelected()||sap.ui.core.IconPool.getIconURI("favorite");break}if(u){i=sap.ui.core.IconPool.createControlByURI({id:this.getId()+"__icon"+this._iIconCounter++,src:u,},sap.m.Image);switch(s){case 1:this.addAggregation("_iconsUnselected",i,true);break;case 2:this.addAggregation("_iconsHovered",i,true);break;case 0:this.addAggregation("_iconsSelected",i,true);break}}return i};
sap.m.RatingIndicator.prototype._calculateSelectedValue=function(e){var s=-1.0,p=0.0,c=this.$(this.getId()),C=(c.innerWidth()-c.width())/2,E;if(e.targetTouches){E=e.targetTouches[0]}else{E=e}if(!E||!E.pageX){E=e;if((!E||!E.pageX)&&e.changedTouches){E=e.changedTouches[0]}}if(!E.pageX){return parseFloat(s)}if(E.pageX<c.offset().left){s=0}else if((E.pageX-c.offset().left)>c.innerWidth()-C){s=this.getMaxValue()}else{p=(E.pageX-c.offset().left-C)/c.width();s=p*this.getMaxValue()}return this._roundValueToVisualMode(s,true)};
sap.m.RatingIndicator.prototype._roundValueToVisualMode=function(v,i){if(i){if(v<0.25){v=0}else if(v<4.75){v+=0.25}v=Math.round(v)}else{if(this.getVisualMode()===sap.m.RatingIndicatorVisualMode.Full){v=Math.round(v)}else if(this.getVisualMode()===sap.m.RatingIndicatorVisualMode.Half){v=Math.round(v*2)/2}}return parseFloat(v)};
sap.m.RatingIndicator.prototype.ontouchstart=function(e){if(this.getEnabled()){e.originalEvent._sapui_handledByControl=true;if(!this._touchEndProxy){this._touchEndProxy=jQuery.proxy(this._ontouchend,this)}if(!this._touchMoveProxy){this._touchMoveProxy=jQuery.proxy(this._ontouchmove,this)}if(jQuery.support.touch){jQuery(window.document).bind("touchend touchcancel",this._touchEndProxy);jQuery(window.document).bind("touchmove",this._touchMoveProxy)}else{jQuery(window.document).bind("mouseup",this._touchEndProxy);jQuery(window.document).bind("mousemove",this._touchMoveProxy)}this._fStartValue=this.getValue();var v=this._calculateSelectedValue(e);if(v>=0&&v<=this.getMaxValue()){this._updateUI(v,true);if(this._fStartValue!==v){this.fireLiveChange({value:v})}}}};
sap.m.RatingIndicator.prototype._ontouchmove=function(e){if(this.getEnabled()){var v=this._calculateSelectedValue(e);if(v>=0&&v<=this.getMaxValue()){this._updateUI(v,true);if(this._fStartValue!==v){this.fireLiveChange({value:v})}}}};
sap.m.RatingIndicator.prototype._ontouchend=function(e){if(this.getEnabled()){var v=this._calculateSelectedValue(e);this.setProperty("value",v,true);this._updateUI(v,false);if(this._fStartValue!==v){this.fireChange({value:v})}if(jQuery.support.touch){jQuery(window.document).unbind("touchend touchcancel",this._touchEndProxy);jQuery(window.document).unbind("touchmove",this._touchMoveProxy)}else{jQuery(window.document).unbind("mouseup",this._touchEndProxy);jQuery(window.document).unbind("mousemove",this._touchMoveProxy)}delete this._fStartValue}};
sap.m.RatingIndicator.prototype.ontouchcancel=sap.m.RatingIndicator.prototype.ontouchend;
