/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.m.Dialog");jQuery.sap.require("sap.m.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.m.Dialog",{metadata:{publicMethods:["open","close","isOpen"],library:"sap.m",properties:{"icon":{type:"sap.ui.core.URI",group:"Appearance",defaultValue:null},"title":{type:"string",group:"Appearance",defaultValue:null},"type":{type:"sap.m.DialogType",group:"Appearance",defaultValue:sap.m.DialogType.Standard},"state":{type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:sap.ui.core.ValueState.None},"stretchOnPhone":{type:"boolean",group:"Appearance",defaultValue:false,deprecated:true},"stretch":{type:"boolean",group:"Appearance",defaultValue:false},"contentWidth":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},"contentHeight":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null}},defaultAggregation:"content",aggregations:{"content":{type:"sap.ui.core.Control",multiple:true,singularName:"content"},"subHeader":{type:"sap.m.Bar",multiple:false},"_header":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_leftButton":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_rightButton":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_title":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_icon":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{"leftButton":{type:"sap.m.Button",multiple:false},"rightButton":{type:"sap.m.Button",multiple:false}},events:{"beforeOpen":{},"afterOpen":{},"beforeClose":{},"afterClose":{}}}});sap.m.Dialog.M_EVENTS={'beforeOpen':'beforeOpen','afterOpen':'afterOpen','beforeClose':'beforeClose','afterClose':'afterClose'};jQuery.sap.require("sap.ui.core.Popup");jQuery.sap.require("sap.m.Bar");jQuery.sap.require("sap.ui.core.delegate.ScrollEnablement");jQuery.sap.require("sap.m.InstanceManager");jQuery.sap.require("sap.ui.core.IconPool");jQuery.sap.require("sap.ui.core.theming.Parameters");jQuery.sap.require("sap.ui.core.ValueState");sap.m.Dialog._bOneDesign=(sap.ui.core.theming.Parameters.get("sapMPlatformDependent")!=='true');sap.m.Dialog._mStateClasses={};sap.m.Dialog._mStateClasses[sap.ui.core.ValueState.None]="";sap.m.Dialog._mStateClasses[sap.ui.core.ValueState.Success]="sapMDialogSuccess";sap.m.Dialog._mStateClasses[sap.ui.core.ValueState.Warning]="sapMDialogWarning";sap.m.Dialog._mStateClasses[sap.ui.core.ValueState.Error]="sapMDialogError";sap.m.Dialog._mIcons={};sap.m.Dialog._mIcons[sap.ui.core.ValueState.Success]=sap.ui.core.IconPool.getIconURI("accept");sap.m.Dialog._mIcons[sap.ui.core.ValueState.Warning]=sap.ui.core.IconPool.getIconURI("warning2");sap.m.Dialog._mIcons[sap.ui.core.ValueState.Error]=sap.ui.core.IconPool.getIconURI("alert");
sap.m.Dialog.prototype.init=function(){var t=this;this._firstOpen=true;this._externalIcon=undefined;this._sResizeListenerId=null;this._$window=jQuery(window);if(sap.m.Dialog._bOneDesign){this._createHeader()}this.oPopup=new sap.ui.core.Popup();this.oPopup.setShadow(true);if(jQuery.device.is.iphone&&!this._bMessageType){this.oPopup.setModal(true,"sapMDialogTransparentBlk")}else{this.oPopup.setModal(true,"sapMDialogBlockLayerInit")}if(jQuery.os.ios||(jQuery.os.android&&jQuery.os.fVersion>2.4)){this.oPopup.setAnimations(jQuery.proxy(this._openAnimation,this),jQuery.proxy(this._closeAnimation,this))}this._fnOrientationChange=jQuery.proxy(this._reposition,this);this.oPopup._applyPosition=function(p){var $=t.$();if(!jQuery.device.is.iphone&&t.oPopup.getOpenState()===sap.ui.core.OpenState.OPEN){$.css("visibility","hidden")}t._setDimensions();t._adjustScrollingPane();sap.ui.core.Popup.prototype._applyPosition.call(this,p);if(!jQuery.device.is.iphone&&t.oPopup.getOpenState()===sap.ui.core.OpenState.OPEN){$.css("visibility","visible")}};this._oScroller=new sap.ui.core.delegate.ScrollEnablement(this,this.getId()+"-scroll",{horizontal:true,vertical:true,zynga:false,preventDefault:false,nonTouchScrolling:"scrollbar"})};
sap.m.Dialog.prototype.onBeforeRendering=function(){if(this._sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sResizeListenerId);this._sResizeListenerId=null}};
sap.m.Dialog.prototype.onAfterRendering=function(){this._$scrollPane=jQuery.sap.byId(this.getId()+"-scroll");this._$content=jQuery.sap.byId(this.getId()+"-cont")};
sap.m.Dialog.prototype.exit=function(){if(this._sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sResizeListenerId);this._sResizeListenerId=null}this._$window.unbind("resize",this._fnOrientationChange);if(this.oPopup){this.oPopup.destroy();this.oPopup=null}if(this._oScroller){this._oScroller.destroy();this._oScroller=null}if(this._header){this._header.destroy();this._header=null}if(this._headerTitle){this._headerTitle.destroy();this._headerTitle=null}if(this._iconImage){this._iconImage.destroy();this._iconImage=null}};
sap.m.Dialog.prototype.open=function(){var p=this.oPopup;if(p.isOpen()){return this}this._oCloseTrigger=null;var $=jQuery("#sap-ui-blocklayer-popup");if($.length>0){var t=jQuery.device.is.iphone&&!this._bMessageType&&!this.hasStyleClass("sapMActionSheetDialog");$.toggleClass("sapMDialogTransparentBlk",t);$.toggleClass("sapMDialogBlockLayerInit",!t)}this.fireBeforeOpen();p.attachEvent(sap.ui.core.Popup.M_EVENTS.opened,this._handleOpened,this);p.setContent(this);if(!sap.m.Dialog._bOneDesign&&jQuery.device.is.iphone&&!this._bMessageType){p.setPosition("center top","center bottom",document,"0 0","fit")}else{p.setPosition("center center","center center",document,"0 0","fit")}p.open();if(!this._sResizeListenerId){this._sResizeListenerId=sap.ui.core.ResizeHandler.register(jQuery.sap.domById(this.getId()+"-scroll"),this._fnOrientationChange)}sap.m.InstanceManager.addDialogInstance(this);return this};
sap.m.Dialog.prototype.close=function(){var p=this.oPopup;var e=this.oPopup.getOpenState();if(!(e===sap.ui.core.OpenState.CLOSED||e===sap.ui.core.OpenState.CLOSING)){this.fireBeforeClose({origin:this._oCloseTrigger});p.attachEvent(sap.ui.core.Popup.M_EVENTS.closed,this._handleClosed,this);p.close()}return this};
sap.m.Dialog.prototype.isOpen=function(){return this.oPopup&&this.oPopup.isOpen()};
sap.m.Dialog.prototype._handleOpened=function(){this.oPopup.detachEvent(sap.ui.core.Popup.M_EVENTS.opened,this._handleOpened,this);this._$window.bind("resize",this._fnOrientationChange);this.fireAfterOpen();this._firstOpen=false};
sap.m.Dialog.prototype._handleClosed=function(){this.oPopup.detachEvent(sap.ui.core.Popup.M_EVENTS.closed,this._handleClosed,this);if(this._sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sResizeListenerId);this._sResizeListenerId=null}this._$window.unbind("resize",this._fnOrientationChange);sap.m.InstanceManager.removeDialogInstance(this);this.fireAfterClose({origin:this._oCloseTrigger})};
sap.m.Dialog.prototype._openAnimation=function(r,R,o){r.css("display","block");if(!sap.m.Dialog._bOneDesign&&jQuery.device.is.iphone&&!this._bMessageType){r.addClass("sapMDialogBottom").removeClass("sapMDialogHidden");window.setTimeout(function(){r.bind("webkitTransitionEnd transitionend",function(){jQuery(this).unbind("webkitTransitionEnd transitionend");r.removeClass("sapMDialogSliding");o()});r.addClass("sapMDialogSliding").removeClass("sapMDialogBottom")},0)}else{r.bind("webkitAnimationEnd animationend",function(){jQuery(this).unbind("webkitTransitionEnd transitionend");o();r.removeClass("sapMDialogOpening")});r.addClass("sapMDialogOpening")}};
sap.m.Dialog.prototype._closeAnimation=function(r,R,c){if(!sap.m.Dialog._bOneDesign&&jQuery.device.is.iphone&&!this._bMessageType){r.bind("webkitTransitionEnd transitionend",function(){jQuery(this).unbind("webkitTransitionEnd transitionend");r.addClass("sapMDialogHidden").removeClass("sapMDialogBottom").removeClass("sapMDialogSliding");c()});r.addClass("sapMDialogSliding").addClass("sapMDialogBottom")}else{if(sap.m.Dialog._bOneDesign||!jQuery.os.ios){r.bind("webkitAnimationEnd animationend",function(){jQuery(this).unbind("webkitTransitionEnd transitionend");c();r.removeClass("sapMDialogClosing")});r.addClass("sapMDialogClosing")}else{c()}}};
sap.m.Dialog.prototype._setDimensions=function(){var w=this._$window.width(),W=this._$window.height(),$=this.$(),s=this.getStretch()&&!this._bMessageType,h=jQuery.device.is.phone?64:128,v=16,p=window.parseInt($.css("padding-left"),10),P=window.parseInt($.css("padding-right"),10),i=window.parseInt($.css("padding-top"),10),a=window.parseInt($.css("padding-bottom"),10),b=this._$content,B=window.parseInt($.css("border-left-width"),10),c=window.parseInt($.css("border-right-width"),10),d=window.parseInt($.css("border-top-width"),10),e=window.parseInt($.css("border-bottom-width"),10),m=w-h,M=W-v,C=this.getContentWidth(),f=this.getContentHeight(),g=this._$scrollPane,S=g.css("position")==="absolute",o=this.getSubHeader(),j,H,k,F,l,n,q,r,I;if(!this._$window){this._$window=jQuery(window)}$.css({"width":"","height":"","min-width":"","max-width":"","left":"0px","top":"0px","right":"","bottom":"","max-height":""});g.css({"width":""});if(jQuery.device.is.tablet||jQuery.device.is.desktop){if(sap.m.Dialog._bOneDesign&&s){$.css({"right":"0px","bottom":"0px","max-height":W+"px"})}else{$.css({"min-width":"400px","max-width":(this._bMessageType?480:m)+"px","max-height":M+"px"})}}else{if(!sap.m.Dialog._bOneDesign&&jQuery.device.is.iphone&&!this._bMessageType){$.css({width:"100%",height:"100%"})}else{if(sap.m.Dialog._bOneDesign&&s){$.css({"width":w+"px","height":W+"px","max-height":W+"px"})}else{if(jQuery.device.is.portrait){$.css({"width":m+"px","max-height":M+"px"})}else{$.css({"min-width":W+"px","max-width":m+"px","max-height":M+"px"})}}}}H=$.children("header.sapMDialogTitle").outerHeight(true);k=o?o.$().outerHeight(true):0;if(!sap.m.Dialog._bOneDesign&&jQuery.os.ios&&!this._bMessageType){F=0}else{F=$.children("footer").outerHeight(true)}j=(((sap.m.Dialog._bOneDesign&&s)||(!sap.m.Dialog._bOneDesign&&jQuery.device.is.iphone&&!this._bMessageType))?W:M)-H-k-F-i-a-d-e;I=(jQuery.device.is.phone&&(jQuery.device.is.portrait||(!sap.m.Dialog._bOneDesign&&jQuery.os.ios)))||(sap.m.Dialog._bOneDesign&&s);b.css({"width":(C&&!I)?Math.max(window.parseInt($.css("min-width"),10)-p-P-B-c,Math.min(window.parseInt(C,10),m-p-P-B-c)):"","max-height":""});if(S){l=g.outerHeight(true);if(sap.m.Dialog._bOneDesign&&s){b.css("height",j)}else{if(f){b.css("height",Math.min(j,window.parseInt(f,10)))}else{b.css("height",Math.min(j,l))}}}else{if((sap.m.Dialog._bOneDesign&&s)||(!sap.m.Dialog._bOneDesign&&jQuery.device.is.iphone&&!this._bMessageType)){b.css("height",j)}else{if(f){b.css("height",Math.min(j,window.parseInt(f,10)))}else{b.css("max-height",j)}}}};
sap.m.Dialog.prototype._adjustScrollingPane=function(){var $=this._$scrollPane;$.css({"width":"auto"});if($.outerWidth(true)<=this._$content.width()){$.css({"width":""})}this._oScroller.refresh()};
sap.m.Dialog.prototype._reposition=function(){var t=this;var e=this.oPopup.getOpenState();if(e!==sap.ui.core.OpenState.OPEN||this._sAvoidRepeatTimer){return}if(jQuery.support.touch){this._sAvoidRepeatTimer=window.setTimeout(function(){t._sAvoidRepeatTimer=null},50)}this.oPopup._applyPosition(this.oPopup._oLastPosition)};
sap.m.Dialog.prototype._createHeader=function(){if(sap.m.Dialog._bOneDesign||(jQuery.os.ios&&!this._bMessageType)){if(!this._header){this._header=new sap.m.Bar(this.getId()+"-header").addStyleClass("sapMHeader-CTX sapMDialogTitle");this.setAggregation("_header",this._header,false)}}};
sap.m.Dialog.prototype._getHeader=function(){if(!sap.m.Dialog._bOneDesign&&!this.getTitle()&&!this.getLeftButton()&!this.getRightButton()){return null}this._createHeader();return this._header};
sap.m.Dialog.prototype._initBlockLayerAnimation=function(){if(!sap.m.Dialog._bOneDesign&&(!jQuery.device.is.iphone||this._bMessageType)){this.oPopup._showBlockLayer=function(){sap.ui.core.Popup.prototype._showBlockLayer.call(this);var $=jQuery("#sap-ui-blocklayer-popup");if(jQuery.os.ios){$.addClass('sapMDialogBLyInit')}else{$.addClass("sapMDialogBlockLayerAnimation");setTimeout(function(){$.addClass("sapMDialogBlockLayer")},0)}};this.oPopup._hideBlockLayer=function(){var $=jQuery("#sap-ui-blocklayer-popup"),t=this;if(sap.ui.core.Popup.blStack.length>1){sap.ui.core.Popup.prototype._hideBlockLayer.call(t)}else{$.removeClass('sapMDialogBlockLayerInit');if(jQuery.os.ios){$.removeClass("sapMDialogBLyInit");sap.ui.core.Popup.prototype._hideBlockLayer.call(t)}else{$.removeClass("sapMDialogBlockLayer");$.bind("webkitTransitionEnd transitionend",function(){jQuery(this).unbind("webkitTransitionEnd transitionend");sap.ui.core.Popup.prototype._hideBlockLayer.call(t);$.removeClass("sapMDialogBlockLayerAnimation")})}}}}else{this.oPopup._hideBlockLayer=function(){var $=jQuery("#sap-ui-blocklayer-popup");$.removeClass("sapMDialogTransparentBlk");sap.ui.core.Popup.prototype._hideBlockLayer.call(this)}}};
sap.m.Dialog.prototype._clearBlockLayerAnimation=function(){if(jQuery.device.is.iphone&&!this._bMessageType){delete this.oPopup._showBlockLayer;this.oPopup._hideBlockLayer=function(){var $=jQuery("#sap-ui-blocklayer-popup");$.removeClass("sapMDialogTransparentBlk");sap.ui.core.Popup.prototype._hideBlockLayer.call(this)}}};
sap.m.Dialog.prototype.getScrollDelegate=function(){return this._oScroller};
sap.m.Dialog.prototype._setButton=function(b,p){var t=this,P=p.charAt(0).toUpperCase()+p.slice(1).toLowerCase(),g="get"+P+"Button",h="content"+P,a=p.toLowerCase()+"Button",H="_"+a,o,O;if(typeof(b)==="string"){b=sap.ui.getCore().byId(b)}o=this[g]();if(b&&O===b.getId()){return this}if(!this._oButtonDelegate){this._oButtonDelegate={ontap:function(){t._oCloseTrigger=this}}}if(o){O=sap.ui.getCore().byId(o);O.removeDelegate(this._oButtonDelegate)}if(b){b.addDelegate(this._oButtonDelegate,true,b);if(sap.m.Dialog._bOneDesign){if(!(b.getType()===sap.m.ButtonType.Accept||b.getType()===sap.m.ButtonType.Reject)){b.setType(sap.m.ButtonType.Transparent)}}}if(!sap.m.Dialog._bOneDesign&&jQuery.os.ios&&!this._bMessageType){this._createHeader();if(b){if(O){this._header.removeAggregation(h,O,true)}this._header.addAggregation(h,b,true);this._header.invalidate()}else{if(O){this._header.removeAggregation(h,O)}}}else{if(b){this.setAggregation(H,b)}else{if(O){this.removeAggregation(H,O)}}}return this.setAssociation(a,b,!sap.m.Dialog._bOneDesign&&jQuery.os.ios&&!this._bMessageType)};
sap.m.Dialog.prototype.setLeftButton=function(b){return this._setButton(b,"left")};
sap.m.Dialog.prototype.setRightButton=function(b){return this._setButton(b,"right")};
sap.m.Dialog.prototype.setTitle=function(t){this.setProperty("title",t,true);if(this._headerTitle){this._headerTitle.setText(t)}else{this._headerTitle=new sap.m.Label(this.getId()+"-title",{text:t}).addStyleClass("sapMDialogTitle");if(sap.m.Dialog._bOneDesign||(jQuery.os.ios&&!this._bMessageType)){this._createHeader();this._header.addContentMiddle(this._headerTitle)}else{this.setAggregation("_title",this._headerTitle)}}return this};
sap.m.Dialog.prototype.setState=function(s){var f={},$=this.$(),n;f[s]=true;this.setProperty("state",s,true);if(sap.m.Dialog._bOneDesign){for(n in sap.m.Dialog._mStateClasses){$.toggleClass(sap.m.Dialog._mStateClasses[n],!!f[n])}this.setIcon(sap.m.Dialog._mIcons[s],true)}};
sap.m.Dialog.prototype.setIcon=function(i,I){if(!I){this._externalIcon=i}else{if(this._externalIcon){i=this._externalIcon}}if(sap.m.Dialog._bOneDesign||!jQuery.os.ios){if(i){if(i!==this.getIcon()){if(this._iconImage){this._iconImage.setSrc(i)}else{this._iconImage=sap.ui.core.IconPool.createControlByURI({id:this.getId()+"-icon",src:i},sap.m.Image).addStyleClass("sapMDialogIcon");if(sap.m.Dialog._bOneDesign){this._createHeader();this._header.insertAggregation("contentMiddle",this._iconImage,0)}else{this.setAggregation("_icon",this._iconImage)}}}}else{var d=this.getState();if(!I&&d!==sap.ui.core.ValueState.None&&sap.m.Dialog._bOneDesign){if(this._iconImage){this._iconImage.setSrc(sap.m.Dialog._mIcons[d])}}else{if(this._iconImage){this._iconImage.destroy();this._iconImage=null}}}}this.setProperty("icon",i,true);return this};
sap.m.Dialog.prototype.setType=function(t){var o=this.getType(),$;if(o===t){return}this._bMessageType=(t===sap.m.DialogType.Message);if(!sap.m.Dialog._bOneDesign&&jQuery.device.is.iphone){$=jQuery("#sap-ui-blocklayer-popup");if(this._bMessageType){if($.length===0){this.oPopup.setModal(true,"sapMDialogBlockLayerInit")}else{$.removeClass("sapMDialogTransparentBlk").addClass("sapMDialogBlockLayerInit");if(this.oPopup.isOpen()){$.addClass("sapMBusyBLyInit sapMBusyBLyShown")}}this.oPopup.setPosition("center center","center center",document,"0 0","fit");this._initBlockLayerAnimation()}else{if($.length===0){this.oPopup.setModal(true,"sapMDialogTransparentBlk")}else{$.removeClass("sapMBusyBLyShown sapMBusyBLyInit").addClass("sapMDialogTransparentBlk")}this.oPopup.setPosition("center top","center bottom",document,"0 0","fit");this._clearBlockLayerAnimation()}}return this.setProperty("type",t,false)};
sap.m.Dialog.prototype.setStretch=function(s){this._bStretchSet=true;return this.setProperty("stretch",s)};
sap.m.Dialog.prototype.setStretchOnPhone=function(s){if(this._bStretchSet){jQuery.sap.log.warning("sap.m.Dialog: stretchOnPhone property is deprecated. Setting stretchOnPhone property is ignored when there's already stretch property set.");return this}this.setProperty("stretchOnPhone",s);return this.setProperty("stretch",s&&jQuery.device.is.phone)};
sap.m.Dialog.prototype.forceInvalidate=sap.ui.core.Control.prototype.invalidate;
sap.m.Dialog.prototype.invalidate=function(o){if(!this._firstOpen){this.forceInvalidate()}};
